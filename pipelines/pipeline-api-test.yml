parameters:
  - name: dataValidationForShapes
    type: boolean
  - name: derivativeRights
    type: boolean
  - name: graphql
    type: boolean
  - name: imageService
    type: boolean
  - name: jobExecutions
    type: boolean
  - name: shapeResource
    type: boolean

jobs:
  - job: Tests
    timeoutInMinutes: 15
    displayName: api_Tests
    workspace:
      clean: all
    container: node
    variables:
      - name: NODE_OPTIONS
        value: --max-old-space-size=8192
    steps:
      - task: Bash@3
        displayName: 'install dependency'
        inputs:
          targetType: 'inline'
          script: 'npm install yarn && yarn install'
      - task: Bash@3
        displayName: 'waiting for the end of the deployment'
        inputs:
          targetType: 'inline'
          script: sleep 1m
      - template: template/run-api-test.yml
        yarnScript: 'dataValidationForShapes'
        parametrs:
          chooseDirTest: ${{ parameters.dataValidationForShapes }}

      - template: template/run-api-test.yml
        yarnScript: 'derivativeReghts'
        parametrs:
          chooseDirTest: ${{ parameters.derivativeRights }}

      - template: template/run-api-test.yml
        yarnScript: 'graphql'
        parametrs:
          chooseDirTest: ${{ parameters.graphql }}

      - template: template/run-api-test.yml
        yarnScript: 'imageService'
        parametrs:
          chooseDirTest: ${{ parameters.imageService }}

      - template: template/run-api-test.yml
        yarnScript: 'job-executions'
        parametrs:
          chooseDirTest: ${{ parameters.jobExecutions }}

      - template: template/run-api-test.yml
        yarnScript: 'shape-resource'
        parametrs:
          chooseDirTest: ${{ parameters.shapeResource }}


      - task: PublishTestResults@2
        condition: succeededOrFailed()
        inputs:
          testResultsFiles: '$(Build.SourcesDirectory)/reports/*.xml'
          failTaskOnFailedTests: true # Optional
        displayName: Publish test Results to AzureDevops